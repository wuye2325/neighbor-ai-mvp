<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>å‘å¸ƒ - é‚»é‡Œåˆ†èº«</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <style>
        body { background: var(--bg-muted); }
        .phone-frame { width: 100%; max-width: 375px; min-height: 100vh; margin: 0 auto; background: var(--bg-muted); display: flex; flex-direction: column; }
        
        /* é¡¶éƒ¨å¯¼èˆª */
        .top-nav { display: flex; justify-content: space-between; align-items: center; padding: 14px 16px; background: var(--bg-card); border-bottom: 0.5px solid var(--border-light); }
        .nav-close { width: 36px; height: 36px; display: flex; justify-content: center; align-items: center; cursor: pointer; color: var(--text-muted); }
        .nav-title { display: flex; align-items: center; gap: 8px; }
        .nav-title .avatar { width: 28px; height: 28px; background: var(--primary-gradient); border-radius: 50%; display: flex; justify-content: center; align-items: center; }
        .nav-title .avatar i { font-size: 12px; color: white; }
        .nav-title span { font-size: 16px; font-weight: 600; color: var(--text-primary); }
        
        /* æ¶ˆæ¯åŒºåŸŸ */
        .messages-container { flex: 1; overflow-y: auto; padding: 16px; }
        
        .message-item { display: flex; margin-bottom: 16px; animation: fadeIn 0.3s ease; }
        .message-item.sent { flex-direction: row-reverse; }
        
        .message-avatar { width: 36px; height: 36px; background: var(--primary-gradient); border-radius: 50%; display: flex; justify-content: center; align-items: center; flex-shrink: 0; }
        .message-avatar i { font-size: 14px; color: white; }
        .message-item.sent .message-avatar { background: var(--bg-card); border: 1.5px solid var(--border-light); }
        .message-item.sent .message-avatar i { color: var(--text-muted); }
        
        .message-content { max-width: 80%; margin: 0 10px; }
        .message-bubble { padding: 14px 18px; border-radius: 20px; font-size: 15px; line-height: 1.6; }
        .message-item.received .message-bubble { background: var(--bg-card); color: var(--text-primary); border-bottom-left-radius: 6px; box-shadow: var(--shadow-xs); }
        .message-item.sent .message-bubble { background: var(--primary-gradient); color: white; border-bottom-right-radius: 6px; }
        .message-time { font-size: 11px; color: var(--text-muted); margin-top: 6px; }
        .message-item.sent .message-time { text-align: right; }
        
        /* å›¾ç‰‡æ¶ˆæ¯ */
        .message-images { display: grid; gap: 4px; margin-top: 8px; border-radius: var(--radius-md); overflow: hidden; }
        .message-images img { width: 100%; border-radius: var(--radius-sm); }
        
        /* æœç´¢ç»“æœå¡ç‰‡ */
        .search-results { background: var(--bg-card); border-radius: var(--radius-lg); margin-top: 10px; box-shadow: var(--shadow-sm); overflow: hidden; }
        .search-header { padding: 12px 16px; background: var(--bg-muted); display: flex; align-items: center; justify-content: space-between; }
        .search-header span { font-size: 13px; color: var(--text-secondary); }
        .search-header .count { color: var(--primary); font-weight: 600; }
        .search-item { display: flex; align-items: center; padding: 14px 16px; border-bottom: 0.5px solid var(--border-light); cursor: pointer; transition: all 0.2s; }
        .search-item:last-child { border-bottom: none; }
        .search-item:active { background: var(--bg-muted); }
        .search-avatar { width: 44px; height: 44px; background: var(--primary-gradient); border-radius: 50%; display: flex; justify-content: center; align-items: center; margin-right: 12px; flex-shrink: 0; }
        .search-avatar i { font-size: 18px; color: white; }
        .search-info { flex: 1; min-width: 0; }
        .search-title { font-size: 14px; font-weight: 600; color: var(--text-primary); margin-bottom: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .search-meta { font-size: 12px; color: var(--text-muted); }
        .search-price { font-size: 15px; font-weight: 700; color: var(--primary); }
        
        /* å‘å¸ƒé¢„è§ˆå¡ç‰‡ */
        .preview-card { background: var(--bg-card); border-radius: var(--radius-lg); margin-top: 10px; box-shadow: var(--shadow-sm); overflow: hidden; }
        .preview-header { padding: 14px 16px; background: var(--primary-bg); display: flex; align-items: center; gap: 10px; }
        .preview-header i { color: var(--primary); }
        .preview-header span { font-size: 14px; font-weight: 600; color: var(--primary); }
        .preview-body { padding: 16px; }
        .preview-field { margin-bottom: 12px; }
        .preview-field:last-child { margin-bottom: 0; }
        .preview-label { font-size: 12px; color: var(--text-muted); margin-bottom: 4px; }
        .preview-value { font-size: 15px; color: var(--text-primary); font-weight: 500; }
        .preview-value.editable { background: var(--bg-muted); padding: 10px 12px; border-radius: var(--radius-md); display: flex; justify-content: space-between; align-items: center; }
        .preview-value.editable:active { background: var(--border-light); }
        .preview-value input { border: none; background: transparent; font-size: 15px; color: var(--text-primary); width: 100%; outline: none; font-weight: 500; }
        .preview-tags { display: flex; flex-wrap: wrap; gap: 6px; }
        .preview-tag { background: var(--bg-muted); color: var(--text-secondary); padding: 5px 12px; border-radius: var(--radius-full); font-size: 13px; }
        .preview-actions { display: flex; gap: 10px; padding: 14px 16px; border-top: 0.5px solid var(--border-light); }
        .preview-btn { flex: 1; padding: 12px; border-radius: var(--radius-md); font-size: 14px; font-weight: 600; cursor: pointer; text-align: center; border: none; transition: all 0.2s; }
        .preview-btn.edit { background: var(--bg-muted); color: var(--text-secondary); }
        .preview-btn.confirm { background: var(--primary-gradient); color: white; box-shadow: var(--shadow-sm); }
        
        /* è¾“å…¥åŒºåŸŸ */
        .input-area { background: var(--bg-card); border-top: 0.5px solid var(--border-light); }
        
        /* åŠŸèƒ½æ’æ§½ - æ ¸å¿ƒ */
        .mode-slots { display: flex; gap: 8px; padding: 12px 16px; background: var(--bg-card); }
        .mode-slot { flex: 1; display: flex; align-items: center; justify-content: center; gap: 6px; padding: 10px 12px; background: var(--bg-muted); border: 2px solid transparent; border-radius: var(--radius-full); font-size: 14px; font-weight: 500; color: var(--text-secondary); cursor: pointer; transition: all 0.2s ease; }
        .mode-slot:active { transform: scale(0.98); }
        .mode-slot.active { background: var(--primary-bg); border-color: var(--primary); color: var(--primary); }
        .mode-slot.active.provide { background: var(--accent-light); border-color: var(--accent); color: var(--accent); }
        .mode-slot.active.need { background: var(--warm-light); border-color: var(--warm); color: var(--warm); }
        .mode-slot i { font-size: 14px; }
        
        /* å›¾ç‰‡é¢„è§ˆ */
        .image-preview { display: flex; gap: 8px; padding: 0 16px 8px; }
        .image-preview-item { width: 56px; height: 56px; border-radius: var(--radius-md); overflow: hidden; position: relative; }
        .image-preview-item img { width: 100%; height: 100%; object-fit: cover; }
        .image-preview-item .remove { position: absolute; top: 2px; right: 2px; width: 18px; height: 18px; background: rgba(0,0,0,0.5); border-radius: 50%; display: flex; justify-content: center; align-items: center; cursor: pointer; }
        .image-preview-item .remove i { font-size: 8px; color: white; }
        
        .input-row { display: flex; align-items: flex-end; gap: 10px; padding: 8px 16px 12px; }
        .input-field { flex: 1; background: var(--bg-muted); border-radius: var(--radius-xl); padding: 12px 16px; display: flex; align-items: center; }
        .input-field textarea { flex: 1; border: none; background: transparent; font-size: 15px; outline: none; resize: none; max-height: 100px; color: var(--text-primary); line-height: 1.4; }
        .input-field textarea::placeholder { color: var(--text-muted); }
        
        .input-actions { display: flex; gap: 6px; }
        .action-btn { width: 42px; height: 42px; border-radius: 50%; display: flex; justify-content: center; align-items: center; cursor: pointer; transition: all 0.2s; border: none; }
        .action-btn.image { background: var(--bg-muted); color: var(--text-muted); }
        .action-btn.image:active { background: var(--primary-bg); color: var(--primary); }
        .action-btn.voice { background: var(--bg-muted); color: var(--text-muted); }
        .action-btn.voice:active { background: var(--warm-light); color: var(--warm); }
        .action-btn.voice.recording { background: var(--error); color: white; animation: pulse 1s infinite; }
        .action-btn.send { background: var(--primary-gradient); color: white; box-shadow: var(--shadow-sm); }
        
        /* å¼•å¯¼æç¤º */
        .hint-bar { padding: 8px 16px; background: var(--bg-muted); font-size: 12px; color: var(--text-muted); text-align: center; transition: all 0.3s; }
        .hint-bar.provide { background: var(--accent-light); color: var(--accent); }
        .hint-bar.need { background: var(--warm-light); color: var(--warm); }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div class="phone-frame">
        <div class="top-nav">
            <div class="nav-close" onclick="location.href='hall.html'">
                <i class="fas fa-times"></i>
            </div>
            <div class="nav-title">
                <div class="avatar"><i class="fas fa-robot"></i></div>
                <span>æ™ºèƒ½åŠ©æ‰‹</span>
            </div>
            <div style="width: 36px;"></div>
        </div>

        <div class="messages-container" id="messagesContainer">
            <!-- åˆå§‹æ¶ˆæ¯ -->
            <div class="message-item received">
                <div class="message-avatar"><i class="fas fa-robot"></i></div>
                <div class="message-content">
                    <div class="message-bubble">ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„é‚»é‡Œåˆ†èº«åŠ©æ‰‹ ğŸ¤–</div>
                    <div class="message-time">åˆšåˆš</div>
                </div>
            </div>
            <div class="message-item received">
                <div class="message-avatar"><i class="fas fa-robot"></i></div>
                <div class="message-content">
                    <div class="message-bubble">æˆ‘å¯ä»¥å¸®ä½ æœç´¢é‚»å±…å‘å¸ƒçš„ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥å¸®ä½ å‘å¸ƒéœ€æ±‚æˆ–æœåŠ¡ã€‚é€‰æ‹©ä¸‹æ–¹æ¨¡å¼ï¼Œæˆ–è€…ç›´æ¥é—®æˆ‘é—®é¢˜~</div>
                    <div class="message-time">åˆšåˆš</div>
                </div>
            </div>
        </div>

        <div class="input-area">
            <!-- åŠŸèƒ½æ’æ§½ -->
            <div class="mode-slots">
                <div class="mode-slot active" id="slotSearch" onclick="selectMode('search')">
                    <i class="fas fa-search"></i>
                    <span>æ™ºèƒ½æœç´¢</span>
                </div>
                <div class="mode-slot provide" id="slotProvide" onclick="selectMode('provide')">
                    <i class="fas fa-hand-holding-heart"></i>
                    <span>æˆ‘æä¾›</span>
                </div>
                <div class="mode-slot need" id="slotNeed" onclick="selectMode('need')">
                    <i class="fas fa-hands-helping"></i>
                    <span>æˆ‘éœ€è¦</span>
                </div>
            </div>
            
            <!-- å¼•å¯¼æç¤º -->
            <div class="hint-bar" id="hintBar">è¾“å…¥é—®é¢˜ï¼Œå¸®ä½ æœç´¢å¹³å°å†…çš„ä¿¡æ¯</div>
            
            <!-- å›¾ç‰‡é¢„è§ˆ -->
            <div class="image-preview" id="imagePreview"></div>
            
            <!-- è¾“å…¥è¡Œ -->
            <div class="input-row">
                <div class="input-field">
                    <textarea id="messageInput" rows="1" placeholder="è¾“å…¥é—®é¢˜æˆ–æè¿°..." oninput="autoResize(this); checkInput()"></textarea>
                </div>
                <div class="input-actions">
                    <div class="action-btn image" onclick="addImage()">
                        <i class="fas fa-image"></i>
                    </div>
                    <div class="action-btn voice" id="voiceBtn" onclick="toggleVoice()">
                        <i class="fas fa-microphone"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="data/mock-data.js"></script>
    <script>
        let currentMode = 'search'; // search | provide | need
        let selectedImages = [];
        let isRecording = false;
        let collectedInfo = { title: '', desc: '', price: '', tags: [], category: '' };
        let hasReceivedInput = false;

        const modeConfig = {
            search: {
                placeholder: 'è¾“å…¥é—®é¢˜ï¼Œå¸®ä½ æœç´¢å¹³å°å†…çš„ä¿¡æ¯',
                hint: 'è¾“å…¥é—®é¢˜ï¼Œå¸®ä½ æœç´¢å¹³å°å†…çš„ä¿¡æ¯',
                greeting: null
            },
            provide: {
                placeholder: 'æè¿°ä½ å¯ä»¥æä¾›çš„æœåŠ¡æˆ–æŠ€èƒ½...',
                hint: 'æè¿°ä½ å¯ä»¥æä¾›çš„æœåŠ¡æˆ–æŠ€èƒ½ï¼Œæˆ‘ä¼šå¸®ä½ æ•´ç†å‘å¸ƒ',
                greeting: 'å¥½çš„ï¼ä½ æœ‰ä»€ä¹ˆæŠ€èƒ½æˆ–æœåŠ¡å¯ä»¥åˆ†äº«ç»™é‚»å±…å‘¢ï¼Ÿæ¯”å¦‚ï¼šé›ç‹—ã€ç»´ä¿®ã€è¾…å¯¼...'
            },
            need: {
                placeholder: 'æè¿°ä½ éœ€è¦ä»€ä¹ˆå¸®åŠ©...',
                hint: 'æè¿°ä½ éœ€è¦ä»€ä¹ˆå¸®åŠ©ï¼Œæˆ‘ä¼šå¸®ä½ æ•´ç†å‘å¸ƒ',
                greeting: 'æ²¡é—®é¢˜ï¼ä½ éœ€è¦é‚»å±…å¸®ä½ åšä»€ä¹ˆå‘¢ï¼Ÿæ¯”å¦‚ï¼šæ‰¾äººé›ç‹—ã€ä¿®å®¶ç”µã€æ”¶å¿«é€’...'
            }
        };

        function selectMode(mode) {
            currentMode = mode;
            
            // æ›´æ–°æ’æ§½çŠ¶æ€
            document.querySelectorAll('.mode-slot').forEach(slot => slot.classList.remove('active'));
            document.getElementById('slot' + mode.charAt(0).toUpperCase() + mode.slice(1)).classList.add('active');
            
            // æ›´æ–°æç¤º
            const config = modeConfig[mode];
            document.getElementById('messageInput').placeholder = config.placeholder;
            const hintBar = document.getElementById('hintBar');
            hintBar.textContent = config.hint;
            hintBar.className = 'hint-bar' + (mode === 'provide' ? ' provide' : mode === 'need' ? ' need' : '');
            
            // å‘é€å¼•å¯¼è¯­ï¼ˆåªå‘ä¸€æ¬¡ï¼‰
            if (config.greeting && !hasReceivedInput) {
                addAIMessage(config.greeting);
            }
            
            document.getElementById('messageInput').focus();
        }

        function autoResize(el) {
            el.style.height = 'auto';
            el.style.height = Math.min(el.scrollHeight, 100) + 'px';
        }

        function checkInput() {
            const input = document.getElementById('messageInput');
            const hasContent = input.value.trim().length > 0 || selectedImages.length > 0;
            
            const voiceBtn = document.getElementById('voiceBtn');
            if (hasContent) {
                voiceBtn.className = 'action-btn send';
                voiceBtn.innerHTML = '<i class="fas fa-paper-plane"></i>';
            } else {
                voiceBtn.className = 'action-btn voice';
                voiceBtn.innerHTML = '<i class="fas fa-microphone"></i>';
            }
        }

        function addImage() {
            if (selectedImages.length >= 9) {
                alert('æœ€å¤šä¸Šä¼ 9å¼ å›¾ç‰‡');
                return;
            }
            const randomId = Math.floor(Math.random() * 100);
            selectedImages.push(`https://picsum.photos/400/400?random=${randomId}`);
            renderImagePreview();
            checkInput();
        }

        function removeImage(index) {
            selectedImages.splice(index, 1);
            renderImagePreview();
            checkInput();
        }

        function renderImagePreview() {
            document.getElementById('imagePreview').innerHTML = selectedImages.map((img, i) => `
                <div class="image-preview-item">
                    <img src="${img}" alt="é¢„è§ˆ">
                    <div class="remove" onclick="removeImage(${i})"><i class="fas fa-times"></i></div>
                </div>
            `).join('');
        }

        function toggleVoice() {
            const input = document.getElementById('messageInput');
            const hasContent = input.value.trim().length > 0 || selectedImages.length > 0;
            
            if (hasContent) {
                sendMessage();
            } else {
                isRecording = !isRecording;
                const voiceBtn = document.getElementById('voiceBtn');
                const hintBar = document.getElementById('hintBar');
                
                if (isRecording) {
                    voiceBtn.classList.add('recording');
                    hintBar.textContent = 'ğŸ”´ æ­£åœ¨å½•éŸ³...ç‚¹å‡»ç»“æŸ';
                } else {
                    voiceBtn.classList.remove('recording');
                    hintBar.textContent = modeConfig[currentMode].hint;
                    
                    // æ¨¡æ‹Ÿè¯­éŸ³è¯†åˆ«
                    setTimeout(() => {
                        const sampleTexts = {
                            search: 'é™„è¿‘æœ‰æ²¡æœ‰äººä¼šä¿®ç©ºè°ƒï¼Ÿ',
                            provide: 'æˆ‘å‘¨æœ«å¯ä»¥å¸®å¿™é›ç‹—ï¼Œæœ‰ç»éªŒ',
                            need: 'å‘¨æœ«éœ€è¦äººå¸®å¿™é›ç‹—'
                        };
                        document.getElementById('messageInput').value = sampleTexts[currentMode];
                        checkInput();
                    }, 500);
                }
            }
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            
            if (!text && selectedImages.length === 0) return;
            
            hasReceivedInput = true;
            const container = document.getElementById('messagesContainer');
            const time = new Date().getHours() + ':' + String(new Date().getMinutes()).padStart(2, '0');
            
            // ç”¨æˆ·æ¶ˆæ¯
            let html = `
                <div class="message-item sent">
                    <div class="message-avatar"><i class="fas fa-user"></i></div>
                    <div class="message-content">
                        ${text ? `<div class="message-bubble">${text}</div>` : ''}
            `;
            
            if (selectedImages.length > 0) {
                html += `<div class="message-images" style="grid-template-columns: repeat(${Math.min(selectedImages.length, 2)}, 1fr)">
                    ${selectedImages.map(img => `<img src="${img}">`).join('')}
                </div>`;
            }
            
            html += `<div class="message-time">${time}</div></div></div>`;
            container.innerHTML += html;
            
            collectedInfo.desc = text;
            
            // æ¸…ç©º
            input.value = '';
            input.style.height = 'auto';
            selectedImages = [];
            renderImagePreview();
            checkInput();
            container.scrollTop = container.scrollHeight;
            
            // AIå“åº”
            setTimeout(() => processByMode(), 600);
        }

        function processByMode() {
            if (currentMode === 'search') {
                processSearch();
            } else {
                processPublish();
            }
        }

        function processSearch() {
            // æ¨¡æ‹Ÿæœç´¢
            const results = [
                { title: 'å®¶ç”µç»´ä¿®ï¼Œ30å¹´ç»éªŒ', name: 'æå”çš„åˆ†èº«', price: 'é¢è®®', match: 95 },
                { title: 'ç©ºè°ƒæ¸…æ´—ç»´ä¿®', name: 'å¼ å¸ˆå‚…çš„åˆ†èº«', price: '50å…ƒ', match: 88 },
                { title: 'å‘¨æœ«å®¶ç”µç»´ä¿®', name: 'ç‹å¸ˆå‚…çš„åˆ†èº«', price: '60å…ƒ', match: 82 }
            ];
            
            const html = `
                <div class="search-results">
                    <div class="search-header">
                        <span>æ‰¾åˆ° <span class="count">${results.length}</span> ä¸ªç›¸å…³ç»“æœ</span>
                    </div>
                    ${results.map(r => `
                        <div class="search-item" onclick="startChat('${r.name}')">
                            <div class="search-avatar"><i class="fas fa-robot"></i></div>
                            <div class="search-info">
                                <div class="search-title">${r.title}</div>
                                <div class="search-meta">${r.name} Â· åŒ¹é…åº¦ ${r.match}%</div>
                            </div>
                            <div class="search-price">${r.price}</div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            addAIMessage('å¸®ä½ æ‰¾åˆ°äº†è¿™äº›é‚»å±…å‘å¸ƒçš„ä¿¡æ¯~', html);
        }

        function processPublish() {
            collectedInfo.title = extractTitle(collectedInfo.desc);
            collectedInfo.tags = extractTags(collectedInfo.desc);
            collectedInfo.price = extractPrice(collectedInfo.desc);
            
            const typeLabel = currentMode === 'provide' ? 'æä¾›' : 'éœ€æ±‚';
            
            const html = `
                <div class="preview-card">
                    <div class="preview-header">
                        <i class="fas fa-magic"></i>
                        <span>å¸®ä½ æ•´ç†å¥½äº†ï¼Œç¡®è®¤å‘å¸ƒï¼Ÿ</span>
                    </div>
                    <div class="preview-body">
                        <div class="preview-field">
                            <div class="preview-label">ç±»å‹</div>
                            <div class="preview-value">${typeLabel}</div>
                        </div>
                        <div class="preview-field">
                            <div class="preview-label">æ ‡é¢˜</div>
                            <div class="preview-value editable">
                                <input type="text" id="editTitle" value="${collectedInfo.title}">
                                <i class="fas fa-pen" style="color: var(--text-muted); font-size: 12px;"></i>
                            </div>
                        </div>
                        <div class="preview-field">
                            <div class="preview-label">æè¿°</div>
                            <div class="preview-value editable">
                                <input type="text" id="editDesc" value="${collectedInfo.desc}">
                                <i class="fas fa-pen" style="color: var(--text-muted); font-size: 12px;"></i>
                            </div>
                        </div>
                        <div class="preview-field">
                            <div class="preview-label">ä»·æ ¼</div>
                            <div class="preview-value editable">
                                <input type="text" id="editPrice" value="${collectedInfo.price || 'é¢è®®'}">
                                <i class="fas fa-pen" style="color: var(--text-muted); font-size: 12px;"></i>
                            </div>
                        </div>
                        <div class="preview-field">
                            <div class="preview-label">æ ‡ç­¾ï¼ˆè‡ªåŠ¨è¯†åˆ«ï¼‰</div>
                            <div class="preview-tags">
                                ${collectedInfo.tags.map(t => `<span class="preview-tag">#${t}</span>`).join('')}
                            </div>
                        </div>
                    </div>
                    <div class="preview-actions">
                        <div class="preview-btn edit" onclick="continueInput()">ç»§ç»­è¯´</div>
                        <div class="preview-btn confirm" onclick="confirmPublish()">ç¡®è®¤å‘å¸ƒ</div>
                    </div>
                </div>
            `;
            
            addAIMessage('æˆ‘å¸®ä½ æ•´ç†äº†ä¸€ä¸‹ï¼Œçœ‹çœ‹å¯¹ä¸å¯¹ï¼Ÿ', html);
        }

        function extractTitle(desc) {
            if (desc.includes('é›ç‹—')) return 'å‘¨æœ«é›ç‹—æœåŠ¡';
            if (desc.includes('ä¿®') || desc.includes('ç»´ä¿®')) return 'å®¶ç”µç»´ä¿®æœåŠ¡';
            if (desc.includes('è¾…å¯¼')) return 'ä½œä¸šè¾…å¯¼';
            return desc.substring(0, 15) + (desc.length > 15 ? '...' : '');
        }

        function extractTags(desc) {
            const tags = [];
            if (desc.includes('é›') || desc.includes('ç‹—')) tags.push('å® ç‰©');
            if (desc.includes('å‘¨æœ«')) tags.push('å‘¨æœ«');
            if (desc.includes('ä¿®')) tags.push('ç»´ä¿®');
            if (tags.length === 0) tags.push('ç”Ÿæ´»æœåŠ¡');
            return tags;
        }

        function extractPrice(desc) {
            const match = desc.match(/(\d+)\s*[å…ƒå—]/);
            return match ? match[1] + 'å…ƒ' : '';
        }

        function startChat(name) {
            alert(`å¼€å§‹ä¸ ${name} èŠå¤©`);
            location.href = 'chat.html';
        }

        function continueInput() {
            addAIMessage('å¥½çš„ï¼Œç»§ç»­è¡¥å……~ è¿˜æœ‰ä»€ä¹ˆè¦è¯´çš„å—ï¼Ÿ');
            document.getElementById('messageInput').focus();
        }

        function confirmPublish() {
            collectedInfo.title = document.getElementById('editTitle')?.value || collectedInfo.title;
            collectedInfo.desc = document.getElementById('editDesc')?.value || collectedInfo.desc;
            collectedInfo.price = document.getElementById('editPrice')?.value || collectedInfo.price;
            
            addAIMessage('å‘å¸ƒæˆåŠŸï¼âœ¨ æˆ‘ä¼šå¸®ä½ æ‰¾åˆ°åˆé€‚çš„é‚»å±…~');
            
            setTimeout(() => {
                if (confirm('å»çœ‹çœ‹å¤§å…ï¼Ÿ')) {
                    location.href = 'hall.html';
                }
            }, 1000);
        }

        function addAIMessage(text, extraContent = '') {
            const container = document.getElementById('messagesContainer');
            const time = new Date().getHours() + ':' + String(new Date().getMinutes()).padStart(2, '0');
            
            container.innerHTML += `
                <div class="message-item received">
                    <div class="message-avatar"><i class="fas fa-robot"></i></div>
                    <div class="message-content">
                        <div class="message-bubble">${text}</div>
                        ${extraContent}
                        <div class="message-time">${time}</div>
                    </div>
                </div>
            `;
            container.scrollTop = container.scrollHeight;
        }

        // å›è½¦å‘é€
        document.getElementById('messageInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });
    </script>
</body>
</html>
